# ICU_early_warming_code
<br>
<br>
　该文件包含代码与数据，共分为三个部分，主要使用SQL与python进行编程<br>
 <br>
## 第一部分，患者信息提取<br>
　　（１）　从ＭＩＭＩＣ　ＩＩＩ数据库中选择满足条件的病例，并对部分完整程度较低的病例数据进行删除，剩余患者１９２４５人，其中１６５５２人存活，２６９３人死亡，随后进行数据补全并计算相应的衍生变量。<br><br><br>

## 第二部分，机器学习模型构建与预测<br>
　　（１）　首先对病例特征进行显著性检验，删除无显著性的９个特征，剩余１５１个特征；<br>
　　（２）　随后使用结合ＲｅｌｉｅｆＦ，Ｆｉｓｈｅｒ，Ｇｉｎｉ三种方法的综合排序方法对病例特征进行排序；　<br>
　　（３）　根据特征排序结果使用８种机器学习模型按特征量逐次递增的方式，通过十折交叉验证计算不同特征子集的预测结果的平均值与标准差；<br>
　　（４）　不同子集预测结果的ＢＥＲ值选择出最优特征子集，最小特征子集的特征量；<br>
　　（５）　通过训练集与验证集得出最优分类阈值，并将其视为参数使用到测试集的预测中，在此最优特征选择标准为使得敏感性与特异性最为相近。同时计算默认阈值下的预测结果<br><br>
  
　
## 第三部分，使用传统评分系统进行患者生死预测<br>
 　　（１）　除去ＭＥＷＳ评分外，ＳＡＰＳＩＩＩ，ＳＯＦＡ，ＡＰＳＩＩＩ，ＯＡＳＩＳ，均能从ＭＩＭＩＣ　ＩＩＩ数据库中直接提取。<br>
 　　（２）　目前选择传统评分系统的最优分类阈值的方法有两个：<br>
 　　 　　 　　ｉ）　(舍弃)通过ＲＯＣ曲线的横纵坐标计算集合　ＴＰＲ＋（１－ＦＰＲ）－１，该集合分布与ＭＣＣ相同，只需找到使其相应原始达到最大的元素即可；<br>
 　　 　　 　ｉｉ）　计算不同阈值下的敏感性与特异性，选择其中使得敏感性最接近特异性的阈值作为最优分类阈值。
 
<br><br><br>


# 函数功能描述<br>
## 19245患者全部信息提取　　文件夹<br>
 　　（１）　1_28612患者提取：　提取满足以下条件的患者，即以下患者满足模型要求，但尚未进行数据预处理<br>
 　　（２）　2_提取血压测量值，为数据补齐做准备q12：　提取患者前12小时无创血压数据及有创血压数据<br>
 　　（３）　3_提取血压测量值，为数据补齐做准备h12：　提取患者进入ICU后12-24小时无创血压数据及有创血压数据<br>
 　　（４）　4_提取血压测量值，为数据补齐做准备all：　提取患者进入ICU第一天无创血压数据及有创血压数据<br>  
 　　（５）　5_提取血压测量值，为数据补齐做准备_插补用信息整合：　整合无创血压、有创血压与其它变量，为接下来的无创血压数据插补做数据准备<br>  
 　　（６）　6_1_随机森林对无创数据的插补：　使用随机森林对缺失的无创血压数据进行插补，使用参数有gender','icutype','age','vent'<br>  
 　　　　　　6_2_其它对无创数据的插补与部分评价指标：　使用平均值，中位数，众数，KNN对缺失数据进行插补，并对插补结果做出相应评价<br> 
 　　　　　　6_3_插补结果评价指标：　计算数据补齐结果的部分评价指标：显著性系数，相关性系数<br> 
 　　（７）　7_1_28612患者前12h血压信息准备：　计算患者进入ICU前12小时无创血压时序数据的衍生变量<br> 
 　　　　　　7_2_28612患者后12h血压信息准备：　计算患者进入ICU 12-24小时无创血压时序数据的衍生变量<br>
 　　　　　　7_3_28612患者前12h其它时序数据信息准备：　计算患者进入ICU前12小时除无创血压外其它时序数据的衍生变量<br>
 　　　　　　7_4_28612患者后12h其它时序数据信息准备：　计算患者进入ICU 12~24 小时除无创血压外其它时序数据的衍生变量<br>
 　　　　　　7_5_28612患者前12h生理变量准备：　汇总患者进入ICU前12小时生理数据的衍生变量<br>
 　　　　　　7_6_28612患者后12h生理变量准备：　计算患者进入ICU 12-24 小时生理数据的衍生变量<br>
 　　　　　　7_7_28612患者生理变量整合：　汇总患者进入ICU第一天生理数据的衍生变量<br>
 　　　　　　7_8_28612患者人口统计变量等准备：　计算患者进入ICU第一天人口统计变量等数据的衍生变量<br>
 　　　　　　
 　　　　　　
 　　　　　　
